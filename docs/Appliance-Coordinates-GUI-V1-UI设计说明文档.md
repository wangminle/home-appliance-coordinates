# 家居设备坐标距离角度绘制工具 - UI设计说明文档 V2.0

## 1. 设计概述

### 1.1 设计目标
创建一个专业、直观、美观的桌面应用界面，基于Matplotlib科学绘图技术栈，为用户提供优秀的家居设备布局规划体验。

### 1.2 设计原则
- **科学计算为本**: 基于Matplotlib的专业科学绘图界面
- **功能性优先**: 界面服务于功能，不做无意义的装饰
- **直观易用**: 操作流程符合科学计算软件的用户直觉
- **视觉协调**: 配色、字体、布局保持一致性
- **响应及时**: 界面反馈及时，状态变化清晰

### 1.3 目标用户
- 智能家居规划师
- 家居装修设计师
- IoT设备布局工程师
- 家庭用户

## 2. 整体布局设计

### 2.1 窗口规格
```
窗口标题: 家居设备坐标距离角度绘制工具 - Matplotlib版
窗口尺寸: 1280x800 像素
布局方式: 左右分割式
左侧区域: 800x800 像素 (Matplotlib可视化展示)
右侧区域: 480x800 像素 (功能操作)
窗口属性: 固定大小，不可调整，启动时屏幕居中
```

### 2.2 布局结构
```
┌─────────────────────────────────────────────────────────────────┐
│              主窗口 (1280x800, Matplotlib版)                      │
├─────────────────────────────┬───────────────────────────────────┤
│                             │                                   │
│     Matplotlib画布区域      │       右侧功能面板区域 (可滚动)   │
│        (800x800)            │            (480x800)              │
│                             │                                   │
│  ┌─────────────────────┐   │  ┌─────────────────────────────┐  │
│  │    Figure/Axes      │   │  │    坐标显示范围/用户坐标系  │  │
│  │    科学绘图区域     │   │  └─────────────────────────────┘  │
│  │                     │   │  ┌─────────────────────────────┐  │
│  │  - 矢量图形渲染     │   │  │       设备管理区域          │  │
│  │  - 整数步进网格     │   │  │     (ttk.Treeview)          │  │
│  │  - 设备点/信息框    │   │  │                             │  │
│  │  - 智能布局避让     │   │  └─────────────────────────────┘  │
│  │  - 交互测量/扇形    │   │  ┌─────────────────────────────┐  │
│  │  - 用户坐标系覆盖层 │   │  │         操作按钮区域        │  │
│  └─────────────────────┘   │  └─────────────────────────────┘  │
└─────────────────────────────┴───────────────────────────────────┘
```

### 2.3 区域功能划分
- **左侧Matplotlib画布**: 专注于科学数据可视化展示和交互。
- **右侧功能面板**: 集成所有用户操作控件，垂直排列，内容超出时可滚动。

## 3. 左侧Matplotlib画布区域设计 (`matplotlib_view.py`)

### 3.1 Figure/Axes基础设计
```python
# Matplotlib Figure配置
figure_size = (8.0, 8.0)          # 8x8英寸
dpi = 100                         # 显示分辨率
facecolor = '#e0f7fa'             # 浅蓝背景
tight_layout = True               # 自动布局优化
aspect = 'equal'                  # 保持X/Y轴等比例
```

### 3.2 坐标系统视觉设计

#### 3.2.1 网格系统
- **网格线颜色**: `#b0bac2` (灰蓝色)
- **网格线宽度**: 0.5
- **网格线样式**: `--` (虚线)
- **网格间距**: 整数步进，主网格每1个单位一条线。

#### 3.2.2 坐标轴
- **轴线颜色**: `#37474f` (深灰色)
- **轴线宽度**: 1.5
- **X/Y轴**: 穿过(0,0)点，贯穿整个绘图区。

#### 3.2.3 原点标记
- **绘制方式**: `plt.scatter([0], [0], ...)`
- **颜色**: `#1e88e5` (蓝色)
- **大小**: `s=50`

#### 3.2.4 刻度标签
- **字体大小**: 10pt
- **颜色**: `#37474f` (深灰色)

### 3.3 设备显示设计

#### 3.3.1 设备标记
- **绘制方式**: `plt.scatter(x, y, ...)`
- **颜色**: `#c62828` (红色)
- **大小**: `s=60`
- **层级 (zorder)**: 10

#### 3.3.2 设备信息框 (名称+坐标)
- **名称标签**: `axes.text(...)`
  - `fontsize`: 12, `fontweight`: 'bold'
  - `color`: `#c62828` (红色)
- **坐标标签**: `axes.text(...)`
  - `fontsize`: 10, `fontweight`: 'normal'
  - `color`: `#c62828` (红色)
- **背景框 (bbox)**:
  - `boxstyle`: "round,pad=0.3"
  - `facecolor`: `#fffde7` (浅黄)
  - `edgecolor`: `#d42c2c` (深红)
  - `linewidth`: 1.5

#### 3.3.3 智能布局与避让系统 (`LayoutManager`)
当设备信息框之间或与其他元素发生重叠时，系统会自动进行智能避让。
- **避让策略**: 为每个设备在四个象限（左上、右上、左下、右下）计算候选位置。
- **优先级**: 根据设备X坐标决定避让顺序。
  - `X < 0`: 优先尝试左上 -> 左下 -> 右上 -> 右下。
  - `X >= 0`: 优先尝试右上 -> 右下 -> 左上 -> 左下。
- **冲突检测**: 计算候选位置与其他所有元素的边界框重叠程度，选择冲突最小的位置。

### 3.4 交互功能设计

#### 3.4.1 交互事件
- **鼠标单击 (左键)**: 创建或移动测量点。
- **鼠标双击 (左键)**: 在测量点位置，以参考点（世界原点或用户位置）为中心绘制90度扇形。
- **鼠标右击**: 清除所有测量点、测量连线和扇形。
- **鼠标移动**: 实时显示十字准星和当前坐标信息。

#### 3.4.2 测量点标记
- **绘制方式**: `plt.scatter(...)`
- **颜色**: `#2e7d32` (绿色)
- **大小**: `s=80`
- **层级 (zorder)**: 20 (最高)

#### 3.4.3 测量连线
- **绘制方式**: `axes.plot(...)`
- **连接**: 从参考点 (世界原点或用户位置) 到测量点。
- **颜色**: `#4caf50` (亮绿色)
- **线宽**: 2.0
- **线型**: `--` (虚线)

#### 3.4.4 测量信息框
- **实现**: `axes.annotate(...)` (Matplotlib注释)
- **字体**: `fontsize=10`
- **背景框 (bbox)**: `facecolor=(1, 1, 1, 0.85)` (半透明白), `edgecolor='#2e7d32'` (绿色)
- **箭头**: 指向测量点。

#### 3.4.5 扇形区域绘制
- **实现**: `matplotlib.patches.Wedge`
- **角度**: 90度，以测量连线为角平分线。
- **填充色**: `(0.827, 0.184, 0.184, 0.2)` (半透明红色)
- **边框色**: `#d42c2c` (深红)
- **线宽**: 1.5

### 3.5 用户坐标系覆盖层

#### 3.5.1 用户位置标记
- **实现**: `axes.scatter(...)`
- **颜色**: `#7b1fa2` (紫色)
- **大小**: `s=150`
- **形状**: `*` (星形)
- **层级 (zorder)**: 15

#### 3.5.2 用户坐标轴
- **实现**: `axes.plot(...)`
- **颜色**: `#7b1fa2` (紫色)
- **线宽**: 1.0
- **线型**: `-.` (点划线)

#### 3.5.3 用户位置信息框
- **实现**: `axes.text(...)`
- **内容**: "用户位置 (User Position)"
- **字体**: `fontsize=12`, `fontweight='bold'`, `color='#7b1fa2'` (紫色)
- **背景框 (bbox)**: `facecolor=(0.96, 0.92, 0.98, 0.85)` (半透明紫色)

## 4. 右侧功能面板设计 (`input_panel.py`)

### 4.1 整体面板设计
- **总宽度**: 480px
- **背景色**: `#ffffff` (白色)
- **内边距**: 10px
- **滚动条**: 当内容超出高度时，自动显示垂直滚动条。

### 4.2 坐标范围与状态区域
- **实现**: `ttk.LabelFrame` (标题: "坐标显示范围设置")
- **坐标范围输入**:
  - `X/Y轴范围`: `ttk.Label` + `ttk.Entry` (宽8, 字体Arial 12), 范围0.1-50.0。
  - `应用设置`: `ttk.Button`。
- **用户坐标系**:
  - `启用用户坐标系`: `ttk.Checkbutton`，勾选后显示下方用户位置设置。
  - `用户位置设置`: 隐藏的`ttk.LabelFrame`，包含X/Y坐标`ttk.Entry`和"设置用户位置"`ttk.Button`。
- **当前状态**:
  - `ttk.LabelFrame` (标题: "当前状态")，用于实时反馈。
  - **坐标系模式**: "世界坐标系" (蓝色) 或 "用户坐标系" (紫色)。
  - **用户位置**: "未设置" (灰色) 或 `(X, Y)` (绿色)。
  - **交互提示**: 根据坐标系模式显示不同提示文本。

### 4.3 设备管理区域
- **实现**: `ttk.LabelFrame` (标题: "设备管理")
- **设备列表**:
  - `ttk.Treeview`，`selectmode='browse'`。
  - **列**: "设备名称" (180px), "X坐标" (100px), "Y坐标" (100px)。
  - **约束**: 最多管理10个设备。
- **设备信息输入**:
  - `名称`, `X坐标`, `Y坐标` 的 `ttk.Entry`。
- **操作按钮**:
  - **添加/更新**: `ttk.Button`，文本根据是否选中设备在"添加设备"和"更新设备"间切换。
  - **删除设备**: `ttk.Button`，选中设备后启用。

### 4.4 操作区域
- **实现**: `ttk.LabelFrame` (标题: "操作")
- **导出按钮**: `ttk.Button`, 文本为 "📷 导出PNG图像"。
- **重置按钮**: `ttk.Button`, 文本为 "重置所有数据"。

## 5. 颜色系统设计 (RGBA / CSS Hex)

| 用途 | 颜色 | 值 (Hex) | 模块 |
| :--- | :--- | :--- | :--- |
| 画布背景 | 浅蓝色 | `#e0f7fa` | `matplotlib_view` |
| 网格线 | 灰蓝色 | `#b0bac2` | `matplotlib_view` |
| 坐标轴/刻度 | 深灰色 | `#37474f` | `matplotlib_view` |
| 世界原点 | 蓝色 | `#1e88e5` | `matplotlib_view` |
| 设备点/标签 | 红色 | `#c62828` | `matplotlib_view` |
| 设备信息框背景 | 浅黄色 | `#fffde7` | `matplotlib_view` |
| 设备信息框边框 | 深红色 | `#d42c2c` | `matplotlib_view` |
| 测量点/信息框 | 绿色 | `#2e7d32` | `matplotlib_view` |
| 测量线 | 亮绿色 | `#4caf50` | `matplotlib_view` |
| 扇形填充 | 半透明红 | `(0.827, 0.184, 0.184, 0.2)` | `matplotlib_view` |
| 用户坐标系 | 紫色 | `#7b1fa2` | `matplotlib_view` |
| 面板背景 | 白色 | `#ffffff` | `input_panel` |
| 面板区域背景 | 浅灰色 | `#f5f5f5` | `input_panel` |

## 6. 字体系统设计

| 用途 | 大小 (pt) | 粗细 | 模块 |
| :--- | :--- | :--- | :--- |
| 坐标轴刻度 | 10 | normal | `matplotlib_view` |
| 设备名称标签 | 12 | bold | `matplotlib_view` |
| 设备坐标标签 | 10 | normal | `matplotlib_view` |
| 测量信息 | 10 | normal | `matplotlib_view` |
| 用户位置标签 | 12 | bold | `matplotlib_view` |
| 面板范围输入 | 12 | normal | `input_panel` |
| 面板状态标签 | 10 | bold/normal | `input_panel` |

## 7. 交互设计规范

### 7.1 Matplotlib画布交互
- **单击**: 在画布上创建测量点，并显示相关信息。
- **双击**: 基于自定义的`DoubleClickDetector`类（使用`event.time`判断时间间隔），在测量点位置绘制90度扇形。
- **右击**: 清除画布上所有交互元素（测量点、线、扇形、信息框）。
- **鼠标移动**:
  - 显示十字准星和坐标信息框。
  - 如果存在测量点，实时更新测量连线和信息框。
- **状态反馈**: 所有交互都通过`canvas.draw_idle()`实现画布的延迟重绘，以优化性能。

### 7.2 Tkinter界面交互
- **设备列表**: 单击`ttk.Treeview`中的条目会：
  - 在右侧输入框中填充该设备的信息。
  - 将"添加设备"按钮切换为"更新设备"。
  - 激活"删除设备"按钮。
- **用户坐标系开关**: `ttk.Checkbutton`状态切换会立即显示或隐藏用户位置输入区域，并更新状态面板和Matplotlib画布。
- **错误处理**: 无效输入（如非数字坐标、名称不符合规范）会通过`tkinter.messagebox.showerror`弹出错误提示框。
- **确认对话框**: 删除、重置等危险操作会通过`messagebox.askyesno`请求用户确认。

## 8. 性能与响应式设计

### 8.1 固定布局
- 应用采用固定的1280x800布局，不支持窗口缩放，以保证各组件比例和布局的稳定性。
- Matplotlib的Figure自适应800x800的左侧区域。

### 8.2 性能优化
- **延迟重绘**: 界面更新主要通过`canvas.draw_idle()`触发，避免了因高频事件（如鼠标移动）导致的频繁重绘，提升了流畅度。
- **数据驱动**: 视图的更新由控制器在数据模型（`DeviceManager`）变化后统一调度，保证了数据与视图的一致性。

## 9. 设计实现总结

### 9.1 技术实现
- **UI框架**: `tkinter` + `ttk`
- **绘图核心**: `matplotlib` + `numpy`
- **架构**: MVC模式，`MatplotlibController`作为核心控制器，`DeviceManager`作为数据中心，`MatplotlibView`和`InputPanel`作为视图。

### 9.2 核心功能亮点
- **科学级绘图**: 完全基于Matplotlib，提供高质量、可定制的矢量图形展示。
- **双坐标系分析**: 支持世界坐标系和可由用户自定义原点的用户坐标系，方便进行相对位置的测量和分析。
- **智能信息框布局**: 实现了基于冲突检测和优先级策略的标签自动避让系统，显著提升了多设备场景下的信息可读性。
- **实时交互反馈**: 无论是画布上的测量交互，还是功能面板上的状态变更，系统都能提供清晰、实时的视觉反馈。
- **数据驱动与模块化**: 清晰的MVC分层和数据驱动的更新机制，使得代码结构清晰，易于维护和扩展。

**最终评价**: 这是一个技术实现优秀、功能完善、交互流畅的现代化科学计算桌面应用。它成功地将`tkinter`的便捷性与`matplotlib`的专业性结合起来，为特定领域的工程师和设计师提供了高效实用的工具。 